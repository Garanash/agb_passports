# Редактор шаблонов паспортов и наклеек

## Описание

Система позволяет редактировать шаблоны паспортов и наклеек прямо из админки в интерактивном режиме. Все изменения сохраняются с автоматическим созданием резервных копий.

## Возможности

### ✅ Управление шаблонами
- Просмотр списка всех шаблонов
- Скачивание шаблонов для редактирования
- Загрузка отредактированных шаблонов
- Автоматическое создание резервных копий при загрузке

### ✅ Версионирование
- Автоматическое сохранение версий при каждой загрузке
- Просмотр истории версий
- Восстановление любой предыдущей версии

### ✅ Валидация
- Проверка наличия обязательных плейсхолдеров
- Проверка структуры документа
- Отображение результатов валидации перед загрузкой

## Использование

### Доступ
1. Войдите в систему как администратор
2. Перейдите во вкладку "Шаблоны" в боковом меню

### Редактирование шаблона

1. **Скачайте текущий шаблон**
   - Нажмите кнопку "Скачать" рядом с нужным шаблоном
   - Файл будет скачан в формате `.docx`

2. **Отредактируйте в Word/LibreOffice**
   - Откройте скачанный файл в Microsoft Word или LibreOffice
   - Внесите необходимые изменения
   - Используйте плейсхолдеры в формате `{{ переменная }}`

3. **Загрузите обратно**
   - Нажмите кнопку "Загрузить"
   - Выберите отредактированный файл
   - Система автоматически проверит шаблон и создаст резервную копию

### Доступные плейсхолдеры

#### Для наклеек (sticker):
- `{{ logo }}` - логотип компании (изображение)
- `{{ nomenclature_name }}` - название номенклатуры
- `{{ article }}` - артикул
- `{{ matrix }}` - типоразмер
- `{{ height }}` - высота матрицы
- `{{ serial_number }}` - серийный номер паспорта
- `{{ production_date }}` - дата производства (год)
- `{{ website }}` - сайт компании
- `{{ date }}` - дата

#### Для паспортов (passport):
- `{{ logo }}` - логотип компании
- `{{ nomenclature_name }}` - название номенклатуры
- `{{ article }}` - артикул
- И другие поля из паспорта

### Восстановление версии

1. Нажмите кнопку "Версии" рядом с шаблоном
2. Выберите нужную версию из списка
3. Нажмите "Восстановить"
4. Текущий шаблон будет сохранен как резервная копия перед восстановлением

## API Endpoints

### GET `/api/v1/templates/`
Получение списка всех шаблонов

### GET `/api/v1/templates/{template_type}`
Скачивание шаблона (sticker или passport)

### POST `/api/v1/templates/{template_type}/upload`
Загрузка нового шаблона
- Параметры:
  - `file`: файл .docx
  - `create_backup`: создавать ли резервную копию (по умолчанию true)

### GET `/api/v1/templates/{template_type}/versions`
Получение списка версий шаблона

### POST `/api/v1/templates/{template_type}/restore/{version}`
Восстановление версии шаблона

### POST `/api/v1/templates/{template_type}/validate`
Валидация шаблона перед загрузкой

## Безопасность

- ✅ Доступ только для администраторов
- ✅ Автоматическое создание резервных копий
- ✅ Валидация перед загрузкой
- ✅ Защита от перезаписи без бэкапа

## Технические детали

### Структура файлов
```
backend/utils/templates/
├── sticker_template.docx      # Текущий шаблон наклеек
├── passport_template.docx     # Текущий шаблон паспортов
└── backups/                    # Резервные копии
    ├── sticker_20240123_120000.docx
    └── passport_20240123_120000.docx
```

### Формат версий
Версии сохраняются с именем: `{template_type}_{YYYYMMDD}_{HHMMSS}.docx`

## Лучшие практики

1. **Всегда создавайте резервные копии** - система делает это автоматически
2. **Проверяйте валидацию** - убедитесь, что все плейсхолдеры на месте
3. **Тестируйте после изменений** - экспортируйте несколько паспортов/наклеек для проверки
4. **Используйте версионирование** - если что-то пошло не так, всегда можно вернуться к предыдущей версии
